ggsn::north(boundary_DF,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
xlims <- c(min(transdf$coords.x1)*0.99, max(transdf$coords.x1)*1.01)
ylims <- c(min(transdf$coords.x2)*0.999, max(transdf$coords.x2)*1.001)
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort,
col="black",alpha=0.6)+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
ggsn::scalebar(boundary_DF,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
ggsn::north(boundary_DF,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort,
col="black",alpha=0.6)+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
LIBS <- c("tidyverse","foreach","readxl","stringi",
"rgdal","ggthemes")
Load_Libs(LIBS)
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort,
col="black",alpha=0.6)+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
WeBS.fort$group
quantile(zipcode@data$continuous_var, seq(0,1,0.33),
na.rm = T), include.lowest = T)
quantile(zipcode@data$continuous_var, seq(0,1,0.33), na.rm = T), include.lowest = T)
WeBS.fort$TOTAL_YRS <- WeBS.poly.UTM30@data$TOTAL_YRS
WeBS.fort$id
WeBS.poly.UTM30@data$id <- rownames(WeBS.poly.UTM30@data)
WeBS.fort <- fortify(WeBS.poly.UTM30)
WeBS.fort <- fortify(WeBS.poly.UTM30,region="id")
WeBS.fort.df <- merge(WeBS.fort,WeBS.poly.UTM30@data,by="id")
xlims <- c(min(transdf$coords.x1)*0.99, max(transdf$coords.x1)*1.01)
ylims <- c(min(transdf$coords.x2)*0.999, max(transdf$coords.x2)*1.001)
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort,
col="black",alpha=0.6)+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
WeBS.poly.UTM30@data
View(assess_ecp)
View(assess_exp)
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(low="white",mid=muted("blue"),high=muted("red"),
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(low="white",mid="blue",high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(low="white",mid="blue",high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
#ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
#ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(low="blue",high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
#ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
#ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(midpoint=12.5,mid="blue",high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
#ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
#ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(midpoint=12.5,low="white",mid="blue",high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
#ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
#ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(midpoint=12.5,low="blue",high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
#ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
#ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(midpoint=12.5,high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
#ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
#ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
G <- ggplot(transdf,aes(x=coords.x1,y=coords.x2)) +
geom_polygon(aes(x=long,y=lat,group=group,fill=TOTAL_YRS),data=WeBS.fort.df,
col="black",alpha=0.6)+
scale_fill_gradient2(high="red",
na.value="white")+
#scale_fill_manual(name="",values=c("SPA" = "lightblue"))+
#geom_point(size=0.8,pch=21,fill="orange")+
scale_x_continuous(breaks=seq(425000,525000,25000),label=seq(4.25,5.25,.25))+
scale_y_continuous(breaks=seq(6380000,6440000,20000),label=seq(6.38,6.44,.02))+
xlab(expression(X(meters~x~10^{"6"})))+
ylab(expression(Y(meters~x~10^{"7"})))+
coord_equal(xlim = xlims, ylim = ylims)+
#ggsn::scalebar(WeBS.fort,location = "bottomright",st.size = 5,height = 0.04,dist = 20,dist_unit = "km",transform = FALSE)+
#ggsn::north(WeBS.fort,scale = 0.15,location = "topleft")+
ggtitle("Total number of years in each WeBS sector")+
theme_gdocs()+
theme(
#panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_rect(colour = "black"),
plot.background = element_blank()
)
G
WeBS.poly.UTM30@data
View(WeBS.poly.UTM30@data)
write.csv(WeBS.poly.UTM30@data,"WeBS_data_available.csv",row.names=F)
expanded <- readRDS("WeBS_expanded_data.rds")
names(expanded)
source("load_libs.R")
LIBS <- c("tidyverse","foreach","readxl","stringi",
"rgdal","ggthemes")
Load_Libs(LIBS)
source("scripts/species_list.R")
All_WeBS <- readxl::read_xlsx("Data/Marine pSPA Seaduck WeBS second extract.xlsx")
All_WeBS <- All_WeBS[All_WeBS$SPECIES %in% Species,]
WeBS_shape <- readOGR("./Data/Jen Data/Banff_to_Helmsdale_WeBS.shp",
layer="Banff_to_Helmsdale_WeBS",verbose = F)
finalmerge <- readRDS("WeBS_merged_to_2020.rds")
spp_in_finalmerge <- unique(finalmerge$SPECIES)
names(finalmerge)
expanded <- finalmerge %>% group_by(SECTOR_NAME,COUNT_DATE)%>%
complete(SPECIES = spp_in_finalmerge) %>%
mutate(
YEAR = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%Y"),
MONTH = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%m"),
SECTORCENTREGRID = checkGrid(SECTORCENTREGRID)
) %>%
dplyr::select(SECTOR_NAME,SECTOR_CODE,SECTORCENTREGRID,COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)
checkGrid <- function(x){
unique(x)[which(!is.na(unique(x)))]
}
expanded <- finalmerge %>% group_by(SECTOR_NAME,COUNT_DATE)%>%
complete(SPECIES = spp_in_finalmerge) %>%
mutate(
YEAR = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%Y"),
MONTH = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%m"),
SECTORCENTREGRID = checkGrid(SECTORCENTREGRID)
) %>%
dplyr::select(SECTOR_NAME,SECTOR_CODE,SECTORCENTREGRID,COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)
expanded$BIRD_COUNT[is.na(expanded$BIRD_COUNT)] <- 0
saveRDS(expanded,"WeBS_expanded_data.rds")
expanded <- readRDS("WeBS_expanded_data.rds")
assess_exp <- expanded %>%
nest(data = c(SECTOR_CODE,COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)) %>%
mutate(
TOTAL_YRS =map_dbl(data,~length(unique(.x$YEAR)))
)
assess_exp
saveRDS(expanded,"WeBS_expanded_data.rds")
expanded <- finalmerge %>% group_by(SECTOR_NAME,COUNT_DATE)%>%
complete(SPECIES = spp_in_finalmerge) %>%
mutate(
YEAR = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%Y"),
MONTH = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%m"),
SECTORCENTREGRID = checkGrid(SECTORCENTREGRID)
) %>%
dplyr::select(SECTOR_NAME,SECTOR_CODE,SECTORCENTREGRID,COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)
expanded$BIRD_COUNT[is.na(expanded$BIRD_COUNT)] <- 0
saveRDS(expanded,"WeBS_expanded_data.rds")
expanded <- readRDS("WeBS_expanded_data.rds")
assess_exp <- expanded %>%
nest(data = c(SECTOR_CODE,COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)) %>%
mutate(
TOTAL_YRS =map_dbl(data,~length(unique(.x$YEAR)))
)
assess_exp
assess_exp$data[1]
expanded <- finalmerge %>% group_by(SECTOR_NAME,COUNT_DATE)%>%
complete(SPECIES = spp_in_finalmerge) %>%
mutate(
YEAR = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%Y"),
MONTH = format(as.Date(COUNT_DATE,format="%Y-%m-%d"),"%m"),
SECTORCENTREGRID = checkGrid(SECTORCENTREGRID),
SECTOR_CODE = checkGrid(SECTOR_CODE)
) %>%
dplyr::select(SECTOR_NAME,SECTOR_CODE,SECTORCENTREGRID,COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)
expanded$BIRD_COUNT[is.na(expanded$BIRD_COUNT)] <- 0
saveRDS(expanded,"WeBS_expanded_data.rds")
expanded <- readRDS("WeBS_expanded_data.rds")
assess_exp <- expanded %>%
nest(data = c(SECTOR_CODE,COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)) %>%
mutate(
TOTAL_YRS =map_dbl(data,~length(unique(.x$YEAR)))
)
assess_exp
assess_exp$data[1]
assess_exp <- expanded %>%
nest(data = c(COUNT_DATE,YEAR,MONTH,SPECIES,BIRD_COUNT)) %>%
mutate(
TOTAL_YRS =map_dbl(data,~length(unique(.x$YEAR)))
)
assess_exp
effort <- readxl::read_xlsx("Data/Marine pSPA WeBS duration - Effort data.xlsx")
warnings()
View(effort)
effort
expanded %>% right_join(effort,by=SECTORCODE)
names(expanded)
names(effort)[2] <- "SECTOR_CODE"
names(effort)
names(effort)[2] <- "SECTORCODE"
expanded %>% right_join(effort,by=SECTORCODE)
names(effort)[2] <- "SECTOR_CODE"
expanded %>% right_join(effort,by=SECTOR_CODE)
effort
expanded
effort
expanded %>% right_join(effort)
expanded %>% right_join(effort,by="SECTOR_CODE")
effort
format(effort$NOMINALDATE,"%m")
effort$MONTH <- format(effort$NOMINALDATE,"%m")
effort$YEAR <- format(effort$NOMINALDATE,"%Y")
effort$YEAR
effort$id <- paste(effort$MONTH,effort$YEAR,as.character(effort$SECTOR_CODE))
expanded$id <- paste(expanded$MONTH,expanded$YEAR,as.character(expanded$SECTOR_CODE))
effort$id
effort$id <- paste0(effort$MONTH,effort$YEAR,as.character(effort$SECTOR_CODE))
expanded$id <- paste0(expanded$MONTH,expanded$YEAR,as.character(expanded$SECTOR_CODE))
effort$id
expanded$id
expanded %>% right_join(effort,by="id")
expanded %>% right_join(effort,by="id",copy=T)
effort %>% right_join(expanded,by="id",copy=T)
test <- effort %>% right_join(expanded,by="id",copy=T)
View(test)
names(test)
joined_dat <- effort %>% right_join(expanded,by="id",copy=T) %>%
dplyr::select(id,SECTOR_NAME,SECTOR_CODE.y,YEAR.y,MONTH.y,
SPECIES,BIRD_COUNT)
joined_dat
joined_dat <- effort %>% right_join(expanded,by="id",copy=T) %>%
dplyr::select(id,SECTOR_NAME,SECTOR_CODE.y,YEAR.y,MONTH.y,DURATION_HRS,
SPECIES,BIRD_COUNT)
joined_dat
names(joined_dat) <- c("id","SECTOR_NAME","SECTOR_CODE","YEAR","MONTH",
"DURATION_HRS","SPECIES","BIRD_COUNT")
assess_exp <- joined_dat %>%
nest(data = c(YEAR,MONTH,SPECIES,BIRD_COUNT)) %>%
mutate(
TOTAL_YRS =map_dbl(data,~length(unique(.x$YEAR)))
)
assess_exp
assess_exp <- joined_dat %>%
nest(data = c(id,YEAR,MONTH,DURATION_HRS,SPECIES,BIRD_COUNT)) %>%
mutate(
TOTAL_YRS =map_dbl(data,~length(unique(.x$YEAR)))
)
assess_exp
saveRDS(assess_exp,"WeBS_final_merged.rds")
# Load libraries ----------------------------------------------------------
source("load_libs.R")
LIBS <- c("tidyverse","foreach","readxl","stringi",
"rgdal","ggthemes")
Load_Libs(LIBS)
# Load shapes -------------------------------------------------------------
source("scripts/species_list.R")
All_WeBS <- readxl::read_xlsx("Data/Marine pSPA Seaduck WeBS second extract.xlsx")
All_WeBS <- All_WeBS[All_WeBS$SPECIES %in% Species,]
WeBS_shape <- readOGR("./Data/Jen Data/Banff_to_Helmsdale_WeBS.shp",
layer="Banff_to_Helmsdale_WeBS",verbose = F)
# Read data ---------------------------------------------------------------
WeBS.format <- readRDS("WeBS_final_merged.rds")
WeBS_shape@polygons
WeBS_shape@polygons$area
WeBS_shape@polygons[[1]]$area
WeBS_shape@polygons[[1]]@area
LIBS <- c("tidyverse","foreach","readxl","stringi",
"rgdal","ggthemes","raster")
Load_Libs(LIBS)
area_sqkm <- area(WeBS_shape)/1000000
area_sqkm
WeBS_shape[1]
area(WeBS_shape[1])/1000000
area(WeBS_shape[[1]])/1000000
expanded <- readRDS("WeBS_expanded_data.rds")
effort <- readxl::read_xlsx("Data/Marine pSPA WeBS duration - Effort data.xlsx")
