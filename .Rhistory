"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
dat
dat <- read_excel(i,sheet = sheets[1])
dat$Vantage_Point <- tolower(dat$Vantage_Point)
dat <- dat %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat
View(dat)
dat <- read_excel(i,sheet = sheets[1])
View(dat)
help(read_excel)
dat <- read_excel(i,sheet = sheets[1])
dat$Vantage_Point <- tolower(dat$Vantage_Point)
dat <- dat %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
dat
samp.size <- length(dat$t.dat.[!is.na(t.dat.)])
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(sheets[1],MONTH,YEAR,meandat)
df
RSPBfiles <- list.files("Data/RSPB_data_filtered/",full.names = TRUE)
spp <- "eider"
i <- RSPBfiles[1]
sheets <- c("Outer_Dornoch_Firth","Inverness_Beauly_Firth","Nairn_Culbin_Bars")
yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
dt <- read_excel(i,sheet = sheets[1])
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(sheets[1],MONTH,YEAR,meandat)
}
yeardata
yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat)
}
yeardata
Species
combined.data <- foreach(i=RSPBfiles,.combine='rbind')%do%{
yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
return(yeardata)
}
RSPBfiles <- list.files("Data/RSPB_data_filtered/",full.names = TRUE)
spp <- "eider"
sheets <- c("Outer_Dornoch_Firth","Inverness_Beauly_Firth","Nairn_Culbin_Bars")
combined.data <- foreach(i=RSPBfiles,.combine='rbind')%do%{
yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
return(yeardata)
}
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
kk
i
dt <- read_excel(i,sheet = kk)
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
for(i in RSPBfiles){
print(i)
#yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
for(kk in sheets){
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
#return(yeardata)
}
combined.data <- foreach(i=RSPBfiles,.combine='rbind')%do%{
yeardata <- foreach(kk=sheets,.combine='rbind') %do% {
dt <- read_excel(i,sheet = kk)
dt$Vantage_Point <- tolower(dt$Vantage_Point)
dat <- dt %>%
dplyr::filter(Vantage_Point %!in% c("date","time",
"wind","cloud",
"visibility","sea_state",
"observer"),
Vantage_Point == spp) %>%
dplyr::select(-Vantage_Point)
dat <- data.frame(t(dat))
dat$t.dat. <- as.numeric(as.character(dat$t.dat.))
tot.sites <- ncol(dat)
samp.size <- length(dat$t.dat.[!is.na(dat$t.dat.)])
meandat <- mean(dat$t.dat.,na.rm=T)
MONTH <- substr(i,(nchar(i)-9),(nchar(i)-7))
YEAR <- substr(i,(nchar(i)-6),(nchar(i)-5))
if(as.numeric(YEAR)>90 & as.numeric(YEAR)<=99){
YEAR = as.numeric(YEAR)+1900
}else{
YEAR = as.numeric(YEAR)+2000
}
df <- data.frame(kk,MONTH,YEAR,meandat,spp)
}
return(yeardata)
}
combined.data
savename <- paste0("outputs/RSPB_",spp,"_counts.rds")
saveRDS(combined.data,savename)
source('D:/PROJECTS_CURRENT/SNH_Moray_Firth/SNH_Moray_Firth/scripts/helpers.R')
source('D:/PROJECTS_CURRENT/SNH_Moray_Firth/SNH_Moray_Firth/scripts/helpers.R')
test <- wrangle.RSPB.data(spp,save.output=T)
test
WeBS <- readRDS("Data/WeBS/WeBS_wrangled_20May2020.rds")
WeBS
View(WeBS)
WeBS <- dplyr::filter(SECTOR_NAME %in% sites.to.extract)
WeBS <- WeBS %>% dplyr::filter(SECTOR_NAME %in% sites.to.extract)
sites.to.extract <- c("Rosemarkie to Avoch","Avoch Bay",
"Easterton - Fort George","Castle Stuart - Westerton",
"Craigiehow to Craigton", "South Kessock",
"Culbin Bar","Nairn Bar","Embo","Golspie")
WeBS <- WeBS %>% dplyr::filter(SECTOR_NAME %in% sites.to.extract)
WeBS.data$SECTOR_NAME <- plyr::revalue(WeBS.data$SECTOR_NAME,
c("Rosemarkie to Avoch" = "Inverness_Beauly_Firth",
"Avoch Bay" = "Inverness_Beauly_Firth",
"Easterton - Fort George" = "Inverness_Beauly_Firth",
"Castle Stuart - Westerton" = "Inverness_Beauly_Firth",
"Craigiehow to Craigton" = "Inverness_Beauly_Firth",
"South Kessock" = "Inverness_Beauly_Firth",
"Culbin Bar" = "Nairn_Culbin_Bars",
"Nairn Bar" = "Nairn_Culbin_Bars",
"Embo" = "Outer_Dornoch_Firth",
"Golspie" = "Outer_Dornoch_Firth"))
WeBS <- readRDS("Data/WeBS/WeBS_wrangled_20May2020.rds")
sites.to.extract <- c("Rosemarkie to Avoch","Avoch Bay",
"Easterton - Fort George","Castle Stuart - Westerton",
"Craigiehow to Craigton", "South Kessock",
"Culbin Bar","Nairn Bar","Embo","Golspie")
WeBS <- WeBS %>% dplyr::filter(SECTOR_NAME %in% sites.to.extract)
View(WeBS)
WeBS.data$SECTOR_NAME <- plyr::revalue(WeBS.data$SECTOR_NAME,
c("Rosemarkie to Avoch" = "Inverness_Beauly_Firth",
"Avoch Bay" = "Inverness_Beauly_Firth",
"Easterton - Fort George" = "Inverness_Beauly_Firth",
"Castle Stuart - Westerton" = "Inverness_Beauly_Firth",
"Craigiehow to Craigton" = "Inverness_Beauly_Firth",
"South Kessock" = "Inverness_Beauly_Firth",
"Culbin Bar" = "Nairn_Culbin_Bars",
"Nairn Bar" = "Nairn_Culbin_Bars",
"Embo" = "Outer_Dornoch_Firth",
"Golspie" = "Outer_Dornoch_Firth"))
WeBS$SECTOR_NAME <- plyr::revalue(WeBS$SECTOR_NAME,
c("Rosemarkie to Avoch" = "Inverness_Beauly_Firth",
"Avoch Bay" = "Inverness_Beauly_Firth",
"Easterton - Fort George" = "Inverness_Beauly_Firth",
"Castle Stuart - Westerton" = "Inverness_Beauly_Firth",
"Craigiehow to Craigton" = "Inverness_Beauly_Firth",
"South Kessock" = "Inverness_Beauly_Firth",
"Culbin Bar" = "Nairn_Culbin_Bars",
"Nairn Bar" = "Nairn_Culbin_Bars",
"Embo" = "Outer_Dornoch_Firth",
"Golspie" = "Outer_Dornoch_Firth"))
WeBS <- readRDS("Data/WeBS/WeBS_wrangled_20May2020.rds")
sites.to.extract <- c("Rosemarkie to Avoch","Avoch Bay",
"Easterton - Fort George","Castle Stuart - Westerton",
"Craigiehow to Craigton", "South Kessock",
"Culbin Bar","Nairn Bar","Embo","Golspie")
sites.to.extract <- c("Rosemarkie to Avoch","Avoch Bay",
"Easterton - Fort George","Castle Stuart - Westerton",
"Craigiehowe to Craigton", "South Kessock",
"Culbin Bar","Nairn Bar","Embo","Golspie")
WeBS <- WeBS %>% dplyr::filter(SECTOR_NAME %in% sites.to.extract)
WeBS$SECTOR_NAME <- plyr::revalue(WeBS$SECTOR_NAME,
c("Rosemarkie to Avoch" = "Inverness_Beauly_Firth",
"Avoch Bay" = "Inverness_Beauly_Firth",
"Easterton - Fort George" = "Inverness_Beauly_Firth",
"Castle Stuart - Westerton" = "Inverness_Beauly_Firth",
"Craigiehowe to Craigton" = "Inverness_Beauly_Firth",
"South Kessock" = "Inverness_Beauly_Firth",
"Culbin Bar" = "Nairn_Culbin_Bars",
"Nairn Bar" = "Nairn_Culbin_Bars",
"Embo" = "Outer_Dornoch_Firth",
"Golspie" = "Outer_Dornoch_Firth"))
WeBS.2 <- WeBS %>% unnest(data)
unique(WeBS.2$SPECIES)
WeBS.2 <- WeBS %>%
unnest(data) %>%
dplyr::filter(tolower(SPECIES)==tolower(spp))
WeBS.2
WeBS.2$MONTH <- plyr::revalue(WeBS.2$MONTH,c("10"="OCT",
"11"="NOV",
"12"="DEC",
"01"="JAN",
"02"="FEB",
"03"="MAR"))
test
WeBS.2
